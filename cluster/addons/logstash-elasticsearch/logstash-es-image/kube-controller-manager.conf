input {
  file {
    path         => ['/var/log/kube-controller-manager.log']
    sincedb_path => "/var/log/kube-controller-manager.log.logstash_sincedb"
    type         => "kube-controller-manager"
    codec        => multiline {
      patterns_dir => [ "/etc/logstash/patterns" ]
      pattern      => "%{GLOG_PREFIX}"
      negate       => true
      what         => "previous"
    }
  }
}

filter {
  ruby {
    code => "
    event.to_hash.keys.each { |k| event[ k.gsub('.','_') ] = event.remove(k) if k.include?'.' }
    "
  }
  if [type] == "kube-controller-manager" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ]
      match        => { "message" => "%{GLOG_PREFIX}%{SPACE}%{GREEDYDATA:log_message}" }
    }
  }
}

